generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model BarberShop {
  id          Int           @id @default(autoincrement())
  name        String
  email       String        @unique
  slug        String        @unique
  address     String
  phone       String
  barbers     Barber[]
  createdAt   DateTime      @default(now())
  hairs       Hair[]
  schedules   Schedule[]
  avaliations Avaliations[]
}

model Avaliations {
  id           Int        @id @default(autoincrement())
  barberShopId Int
  barberShop   BarberShop @relation(fields: [barberShopId], references: [id])
  rating       Int
  comment      String?
  createdAt    DateTime   @default(now())
}

model Barber {
  id           Int        @id @default(autoincrement())
  barberShopId Int
  barberShop   BarberShop @relation(fields: [barberShopId], references: [id])
  name         String
  email        String     @unique
  phone        String
  createdAt    DateTime   @default(now())
}

model Hair {
  id           Int        @id @default(autoincrement())
  photoUrl     String
  name         String
  price        Float
  barberShopId Int
  barberShop   BarberShop @relation(fields: [barberShopId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

enum ScheduleModel {
  WEEK
  CUSTOM
  UNAVAILABLE
}

model Schedule {
  id                    Int                    @id @default(autoincrement())
  barberShopId          Int
  barberShop            BarberShop             @relation(fields: [barberShopId], references: [id])
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  model                 ScheduleModel
  week                  ScheduleWeek[]
  custom                ScheduleCustom[]
  scheduleNotAvailables ScheduleNotAvailable[]
}

model ScheduleWeek {
  id         Int              @id @default(autoincrement())
  dayOfWeek  Int
  periods    SchedulePeriod[]
  createdAt  DateTime         @default(now())
  scheduleId Int
  schedule   Schedule         @relation(fields: [scheduleId], references: [id])
}

model ScheduleCustom {
  id         Int              @id @default(autoincrement())
  date       DateTime
  periods    SchedulePeriod[]
  createdAt  DateTime         @default(now())
  scheduleId Int
  schedule   Schedule         @relation(fields: [scheduleId], references: [id])
}

model SchedulePeriod {
  id               Int             @id @default(autoincrement())
  startTime        DateTime
  endTime          DateTime
  duration         Int
  scheduleWeekId   Int?
  scheduleWeek     ScheduleWeek?   @relation(fields: [scheduleWeekId], references: [id])
  scheduleCustomId Int?
  scheduleCustom   ScheduleCustom? @relation(fields: [scheduleCustomId], references: [id])
  createdAt        DateTime        @default(now())
}

model ScheduleNotAvailable {
  id         Int      @id @default(autoincrement())
  date       DateTime
  createdAt  DateTime @default(now())
  scheduleId Int
  schedule   Schedule @relation(fields: [scheduleId], references: [id])
}
